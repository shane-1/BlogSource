# AWS DevOps

>微服务
>
>敏捷

## 任务拆分

- 拆分单元尽可能小
- 划分数据域
- 根据scaling factors而不是职能部门来解耦
- 服务间独立运行
- 服务间通过api直接调用

**这将使组织结果发生变化**

## 整体开发生命周期

```
开发者 --->  服务  ---> 交付流水线(build ---> test ---> release --> monitor)
```

> 每个server独立部署

## Amazon DevOps的三大定律

1. 拆分任务
2. 团队自主运行
3. 技术规范化

## why DevOps

1. 快速发布
2. 反脆弱
3. 消除技术债务

> 灰度部署:先进行部分试部署上线

## DevOps构成

### 持续规划

1. 考虑运维
2. 需求
3. 共创合作

### 持续开发

1. 版本管理 `codecommit`
2. 分支管理

### 持续测试

- 自动化测试

1. 静态代码检查
2. 单元测试
3. 接口测试
4. UI测试
5. 压力测试
6. 安全测试

### 持续集成

1. Trunk提交
2. 触发job
   1. pull
   2. 冲突
   3. 静态代码检查
   4. 编译
   5. 单元测试
   6. 打包
   7. 部署dev
   8. 测试

### 持续部署

1. 部署test

2. 测试

3. 部署production

   - 部署自动化

   - 参数配置->配置管理

     >1. 部署过程自动化,减少高频部署人为错误
     >2. 所有对环境的改动经统一入口
     >3. Dev\Test\Pro环境尽量保持一致

   - 容器化

   - 部署方式

     - 蓝绿部署
     - 灰度部署(金丝雀)

### 持续监控

1. `ELK` 收集日志
2. `elasticsearch` 搜索引擎
3. `kibana` 界面展示

## 部署vs发布

### 部署:

 又称交付,IT部门操作,技术能力

### 发布:

业务部门,业务决定

## 部署流水线

> 评估所有对系统的改动,能够侦测对高风险或对质量有影响的改动拒绝集成,持续给团队提供相关改动反馈,让团队有能力快速经济的修复问题

## 案例分析



## 单体式应用  Monolithic

- 软件高度耦合
- 构建/测试/发布 周期长

### 问题

- 扩展性差

- 缺乏灵活性

- 系统运维十分困难

- 软件架构难以维护和发展

- 缺乏创新

- 开发速度慢

  ...

## 微服务 MicroService

- 服务注册\发现
- 网关
- 配置中心
- 链路追踪

### 定义

<u>微服务= Service-oriented architecture + "小" public API</u>

> 没有总线,会导致复杂的互相调用的链路

### 注意事项

#### 身份验证

#### 授权(权限管理)

#### 根据需要自动扩展服务

(CPU\TPS访问量)

#### API向后兼容

#### 隐藏你的数据

## 敏捷 Scrum

**个体和交互高于工具和流程**

- 自管理团队
- T型人才
- 引导团队自主解决问题
- 跨职能

### 每日站会

同步信息

~~非签到会\成果会~~

> 看板\燃尽图:信息辐射源

### Scrum Master

角色:确保团队遵循Scrum

~~团队的直接领导~~

### Product Owner

角色:梳理product backlog,排序\解释\验收

- 具有对产品的构想

- 管理产品代办事项列表

- 在产品待办事项类别中按照优先级安排用户故事

### Develop Team

角色:构建\交付\并监控高质量的软件

### 高带宽沟通

推荐面对面沟通

### 335

3个角色3个中间产物

> - Product backlog
> - Sprint backlog
> - Product Increment

5个活动

1. Product backlog grooming:

   - 排优先级

   - 讨论用户故事必要性

   - 增删改

   - 具备独立性

     > (PO主导)

2. Sprint Planning meeting

   - 决定迭代目标(承诺)
   - 输入:初始迭代目标\团队速率\团队情况
   - 输出:Sprint Backlog
   - 全员参加(一次迭代1-4周)
   - 估算:功能点估算

   > 迭代推荐2-3周,合理解冻客服需求时间.可以交付较大\较重要的stories.

   故事点:

   1. 可以计算出相对数字
   2. 可以屏蔽噪音

   

3. Daily Standup

   ​	3个问题

   1. 昨天做了什么
   2. 今天要做什么
   3. 遇到了什么问题

4. Review

   - 输入:迭代需求列表\潜在的可交付产品增量
   - 输出:经过梳理的需求

5. **Retrospective**

### 三大支柱

- 透明
- 检查
- 适应

### Sprint Board

- 任务看板
- 故事看板

> WIP:限制某列的数量
>
> 解决项目推进的瓶颈

## AWS CloudFormation

- 基础架构即代码
- 集成版本控制
- JSON/YAML格式
- 模板-Template
- 堆栈-Stack
- 支持所有AWS资源类型

![](/images/2020-10-26-16-15-59.png)

## VPC资源














