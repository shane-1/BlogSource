# Redis

## NoSQL概述

### 为什么要用NoSQL

> 大数据时代,传统SQL不满足需求

#### 单机MySQL的年代

![](/images/2020-11-16-09-47-24.png)   

**90s:**

- 一个基本的网站的访问量一般不会太大,单机够用
- 静态网页\服务器压力小

**网站瓶颈:**

- 数据量太大,一个机器放不下!

- 数据的索引(B+Tree),一个机器内存放不下

- 访问量(读写混合),一个服务器也放不下

  > 出现以上任一情况,都需要升级

#### Memcached(缓存) + MySQL + 垂直拆分(读写分离)

网站80%的情况都是在读,每次都要去查询数据库的话就十分的麻烦!所以说我们希望减轻数据的压力,我们可以使用缓存来保证效率!

**发展过程:**

优化数据结构和索引	-->	文件缓存(IO)	-->	Memcached

![](/images/2020-11-16-09-59-59.png)

#### 分库分表  + 水平拆分 + MySQL集群

技术和业务发展的同时,对人的要求越来越高!

**<u>本质:数据库(读\写)</u>**

早年MyISAM: 表锁,十分影响效率!高并发下就会出现严重的锁问题

转战Innodb:行锁

慢慢的就开始使用分库分表来解决写的压力!MySQL在那个年代推出了<u>表分区</u>!这个并没有多少公司使用!

MySQL的集群,很好满足了那个年代的需求!

![](/images/2020-11-16-10-05-59.png)

#### 当今

MySQL等关系型数据库就不够用了!数据量很多,变化很快~!

MySQL有点使用它来存储比较大的文件(图片\博客)!数据库表很大,效率就低了!如果有一种数据库来专门处理这种数据.

MySQL的压力就变得十分小(研究处理这些问题!)大数据的IO压力下,表集合没法更大!

![](/images/2020-11-16-10-20-13.png)

#### 总结

- 用户的个人信息,社交网络,地理位置.用户自己产生的数据,用户日志等爆发式增长!
- 这时候我们就需要使用NoSQL数据库,NoSQL能很好处理以上情况!

### 什么是NoSQL

> NoSQL = Not Only SQL

关系型数据库: 表格, 行, 列 (OPI)

泛指非关系数据库的,随着web2.0互联网的诞生!传统的关系型数据库很难对付web2.0时代!尤其是超大规模的高并发的社区!暴露出很多难以克服的问题,NoSQL在当今大数据环境下发展得十分迅速,Redis是发展最快的,而且是我们当下必须要掌握的技术!

很多的数据类型用户的个人信息,社交网络,地理位置.这些数据类型的储存不需要一个固定的格式!不需要多月的操作就可以横向扩展的!Map<String,Obeject>使用键值对来控制的!

### NoSQL特点

解耦

1. 方便扩展(数据之间没有关系,很好扩展!)

2. 大数据量高性能(Redis一秒写8万次,读取11万,NoSQL的缓存记录级,是一种细粒度的缓存,性能会比较高!)

3. 数据类型是多样性的!(不需要事先设计数据库!随取随用!如果是数据量十分大的表,很多人就无法设计了!)

4. 传统RDBMS和NoSQL

   ```
   传统的RDBMS
   - 结构化组织
   - 数据和关系都存在单独的表中
   - 数据操作 数据定义语言
   - 严格的一致性
   - 基础的事务
   - ...
   ```

   ```
   NoSQL
   - 不仅仅是数据
   - 没有固定的查询语言
   - 键值对存储, 列存储, 文档存储, 图形数据库(社交关系)
   - 最终一致性
   - CAP定理和BASE (异地多活)初级架构
   - 高性能, 高可用, 高扩展 
   - ...
   ```

### 了解: 3V+3高

大数据时代的3V: 主要是描述问题的

1. Volume 海量
2. Variety 多样
3. Velocity 实时

大数据时代的3高: 主要是对程序的要求

1. 高并发
2. 高可拓(随时水平拆分,弹性伸缩)
3. 高性能

真正的公司实践: NoSQL + RDBMS一起使用才是最强的

## 阿里巴巴的架构演进

**敏捷开发 + 极限编程**

![](/images/2020-11-16-12-10-45.png)
![](/images/2020-11-16-12-11-33.png)

没有什么是加一层解决不了了

```
# 1. 商品的基本信息
名称、价格、商家信息
关系型数据库就可以解决了!MySQL/ Oracle(淘宝早年就去IOE了!-王坚-推荐文章:阿里云的这群疯子)
淘宝内部的 MySQL不是大家用的MySQL
# 2. 商品的描述、评论(文字比较多)
	文档型数据库中,MongoDB
# 3. 图片
分布式文件系统 FastDFS
- 淘宝 TFS
- Google GFS
- Hadop HDFS
- 阿里云 oss
# 4. 商品的关键字(搜索)
- 搜索引擎 solr elasticsearch
- ISerach 多隆
# 5. 商品热门的波段信息
- 内存数据库
- Redis Tair Memache...
# 6. 商品的交易\外部的制服接口
- 三方应用
```

一个简单的网页背后的技术一定不简单

### 大型互联网的问题:

- 数据类型太多了
- 数据源繁多,经常重构
- 数据要改造,大面积改造

### 解决方案

![](/images/2020-11-16-13-28-19.png)

![](/images/2020-11-16-13-29-42.png)

## NoSQL的四大分类

### KV键值对:

- 新浪: Redis
- 美图: Redis + Tair
- 阿里\百度: Redis + memecache

### 文档型数据库(bson格式和json一样):

- MongoDB(一般必须要掌握)
  - MongoDB是一个基于分布式文件储存的数据库,C++编写,主要用来处理大量的文档!
  - MongoDB是一样介于关系型数据库和非关系型数据库的中间产品!MongoDB是非关系型数据库功能最丰富,最像关系型数据库的!
- ConthDB

### 列存储数据库

- HBase
- 分布式文件系统

### 图关系数据库

![](/images/2020-11-16-13-36-59.png)

- 它不是存图形的,放的是关系. 比如:朋友圈社交网络,广告推荐!
- Neo4j, InfoGrid;

### 对比

![](/images/2020-11-16-13-40-46.png)

## Redis入门

### 概述

> Redis (Remote Dictionary Server), 远程字典服务

是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库,并提供多种语言的APl。是当下最热门的NoSQL技术之一!也被人们称为结构化数据库!

### 功能

1. 内存存储, 持久化, 内存中是断电即失, 所以持久化**(rdb\aof)**很重要
2. 效率高, 可以用于高速缓存
3. 发布订阅系统
4. 地图信息分析
5. 计时器, 计数器(浏览量)
6. ...

### 特性

1. 多样的数据类型
2. 持久化
3. 集群
4. 事务
5. ...

### 相关资源

1. 官网: https://redis.io/
2. 中文官网: http://reids.cn/
3. 下载地址: 通过官网下载

> 注意: Windows版本在GitHub下载
>
> **推荐在Linux服务器搭建**

### Windows安装

1. 下载安装包: https://github.com/dmajkic/redis/releases

2. 下载完毕得到压缩包:

![](/images/2020-11-16-13-56-18.png)   

3. 解压到对应文件夹

4. 开启Redis,双击运行服务即可

![](/images/2020-11-16-13-57-57.png)

5. 使用客户端来连接Redis

![](/images/2020-11-16-14-00-04.png)   

> 默认端口6379

### Linux安装

1. 下载tar.gz包

2. 解压redis的安装包(推荐/opt目录)

![](/images/2020-11-16-14-30-56.png)

3. 进入解压后的文件,可以看到redis的配置文件

![](/images/2020-11-16-14-35-36.png)

4. 基本环境准备

   1. yum install gcc-c++
   2. make 
   3. make install
![](/images/2020-11-16-14-53-55.png)
![](/images/2020-11-16-14-54-38.png)

5. redis的默认安装路径`/usr/local/bin`

![](/images/2020-11-16-14-46-02.png)   

6. 将redis的配置文件复制到当前目录

![](/images/2020-11-16-14-57-27.png)   

7. redis默认不是后台启动,修改配置文件

![](/images/2020-11-16-14-58-31.png)

8. 启动redis服务`redis-server  dir/redis.cofig`

![](/images/2020-11-16-14-59-47.png)

9. 使用redis-cli进行连接测试`redis-cli -p 6379`

![](/images/2020-11-16-15-01-33.png)   

10. 查看redis的进程是否开启`ps -ef|grep redis`

![](/images/2020-11-16-15-02-25.png)    

11. 关闭redis服务`shut down`

![](/images/2020-11-16-15-03-16.png)

## 测试性能

<u>redis-benchmark</u> 是一个压力测试工具!

官方自带的性能测试工具

### redis-benchmark命令参数

![](/images/2020-11-16-15-16-03.png)
















