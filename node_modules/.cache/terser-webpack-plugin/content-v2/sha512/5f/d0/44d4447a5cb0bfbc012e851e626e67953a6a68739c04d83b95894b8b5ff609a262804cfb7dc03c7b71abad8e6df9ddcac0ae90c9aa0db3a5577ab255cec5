{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{447:function(t,_,v){\"use strict\";v.r(_);var s=v(28),r=Object(s.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[v(\"h1\",{attrs:{id:\"基于ads平台流水线的flyway实践\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#基于ads平台流水线的flyway实践\"}},[t._v(\"#\")]),t._v(\" 基于ADS平台流水线的Flyway实践\")]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-28-48.png\",alt:\"\"}})]),t._v(\" \"),v(\"h2\",{attrs:{id:\"一、前言\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#一、前言\"}},[t._v(\"#\")]),t._v(\" 一、前言\")]),t._v(\" \"),v(\"p\",[t._v(\"随着项目的不断迭代，数据库表结构、数据都在发生着变化。甚至有的业务在多环境版本并行运行。数据为王的时代，管理好数据库的版本也成为了迫切的需要。如何能做到像 \"),v(\"strong\",[t._v(\"Git\")]),t._v(\" 之类的版本控制工具来管理数据库？\")]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 是一个敏捷工具，用于数据库的移植。采用 Java 开发，支持所有兼容 JDBC 的数据库。\")]),t._v(\" \"),v(\"p\",[t._v(\"主要用于在你的应用版本不断升级的同时，升级你的数据库结构和里面的数据。\")]),t._v(\" \"),v(\"p\",[t._v(\"支持的数据库\")]),t._v(\" \"),v(\"blockquote\"),t._v(\" \"),v(\"p\",[t._v(\"Oracle、SQL Server、DB2、MySQL、Aurora MySQL、MariaDB、Percona XtraDB群集、PostgreSQL、Aurora PostgreSQL、Redshift、CockroachDB、SAP HANA、Sybase ASE、Informix、H2、HSQLDB、Derby、SQLite、Firebird\")]),t._v(\" \"),v(\"h2\",{attrs:{id:\"二、flyway-的特点\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#二、flyway-的特点\"}},[t._v(\"#\")]),t._v(\" 二、Flyway 的特点\")]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 大受欢迎是因为它具有以下优点：\")]),t._v(\" \"),v(\"ul\",[v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"简单\")]),t._v(\" 非常容易安装和学习，同时迁移的方式也很容易被开发者接受。\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"专一\")]),t._v(\" \"),v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 专注于搞数据库迁移、版本控制而并没有其它副作用。\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"强大\")]),t._v(\" 专为连续交付而设计。让Flyway在应用程序启动时迁移数据库。\")])])]),t._v(\" \"),v(\"h2\",{attrs:{id:\"三、flyway-的工作机制\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#三、flyway-的工作机制\"}},[t._v(\"#\")]),t._v(\" 三、Flyway 的工作机制\")]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 需要在 DB 中先创建一个 metadata 表 (缺省表名为 flyway_schema_history), 在该表中保存着每次 migration （迁移）的记录, 记录包含 migration 脚本的版本号和 \"),v(\"strong\",[t._v(\"SQL\")]),t._v(\" 脚本的 checksum 值。下图表示了多个数据库版本。\\n\"),v(\"img\",{attrs:{src:\"/images/2021-08-03-18-31-38.png\",alt:\"\"}}),t._v(\"\\n对应的 \"),v(\"u\",[t._v(\"metadata\")]),t._v(\" 表记录：\")]),t._v(\" \"),v(\"table\",[v(\"thead\",[v(\"tr\",[v(\"th\",[v(\"strong\",[t._v(\"installed_rank\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"version\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"description\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"type\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"script\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"checksum\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"installed_by\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"installed_on\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"execution_time\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"success\")])])])]),t._v(\" \"),v(\"tbody\",[v(\"tr\",[v(\"td\",[v(\"strong\",[t._v(\"1\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"1\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"Initial Setup\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"SQL\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"V1__Initial_Setup.sql\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"1996767037\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"axel\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2016-02-04  22:23:00.0\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"546\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"true\")])])]),t._v(\" \"),v(\"tr\",[v(\"td\",[v(\"strong\",[t._v(\"2\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"First Changes\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"SQL\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"V2__First_Changes.sql\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"1279644856\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"axel\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2016-02-06  09:18:00.0\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"127\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"true\")])])])])]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 扫描文件系统或应用程序的类路径读取 \"),v(\"strong\",[t._v(\"DDL\")]),t._v(\" 和 \"),v(\"strong\",[t._v(\"DML\")]),t._v(\" 以进行迁移。根据\"),v(\"u\",[t._v(\"metadata\")]),t._v(\" 表进行检查迁移。\"),v(\"strong\",[t._v(\"如果脚本声明的版本号小于或等于标记为当前版本的版本号之一，将忽略它们。其余迁移是待处理迁移：可用，但未应用。最后按版本号对它们进行排序并按顺序执行\")]),t._v(\" \"),v(\"strong\",[t._v(\"并将执行结果写入\")]),t._v(\" \"),v(\"strong\",[t._v(\"metadata\")]),t._v(\" \"),v(\"strong\",[t._v(\"表。\")])]),t._v(\" \"),v(\"p\",[t._v(\"对应的 \"),v(\"u\",[t._v(\"metadata\")]),t._v(\" 表记录：\")]),t._v(\" \"),v(\"table\",[v(\"thead\",[v(\"tr\",[v(\"th\",[v(\"strong\",[t._v(\"installed_rank\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"version\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"description\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"type\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"script\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"checksum\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"installed_by\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"installed_on\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"execution_time\")])]),t._v(\" \"),v(\"th\",[v(\"strong\",[t._v(\"success\")])])])]),t._v(\" \"),v(\"tbody\",[v(\"tr\",[v(\"td\",[v(\"strong\",[t._v(\"1\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"1\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"Initial Setup\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"SQL\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"V1__Initial_Setup.sql\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"1996767037\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"axel\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2016-02-04  22:23:00.0\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"546\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"true\")])])]),t._v(\" \"),v(\"tr\",[v(\"td\",[v(\"strong\",[t._v(\"2\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"First Changes\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"SQL\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"V2__First_Changes.sql\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"1279644856\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"axel\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2016-02-06  09:18:00.0\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"127\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"true\")])])]),t._v(\" \"),v(\"tr\",[v(\"td\",[v(\"strong\",[t._v(\"3\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2.1\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"Refactoring\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"JDBC\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"V2_1__Refactoring\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"axel\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"2016-02-10\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"17:45:05.4\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"251\")])]),t._v(\" \"),v(\"td\",[v(\"strong\",[t._v(\"true\")])])])])]),t._v(\" \"),v(\"p\",[t._v(\"Flyway 支持命令行（需要下载命令行工具）和 \"),v(\"strong\",[t._v(\"Java Api\")]),t._v(\" ，也支持构建工具 \"),v(\"strong\",[t._v(\"Maven\")]),t._v(\" 和 \"),v(\"strong\",[t._v(\"Gradle\")]),t._v(\" 。这里我们主要介绍和ADS流水线的集成\")]),t._v(\" \"),v(\"h2\",{attrs:{id:\"四、flyway-的规则\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#四、flyway-的规则\"}},[t._v(\"#\")]),t._v(\" 四、Flyway 的规则\")]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 是如何比较两个 \"),v(\"strong\",[t._v(\"SQL\")]),t._v(\" 文件的先后顺序呢？它采用 \"),v(\"strong\",[t._v(\"采用左对齐原则\")]),t._v(\"**,** \"),v(\"strong\",[t._v(\"缺位用\")]),t._v(\" \"),v(\"strong\",[t._v(\"0\")]),t._v(\" \"),v(\"strong\",[t._v(\"代替\")]),t._v(\" 。举几个例子：\")]),t._v(\" \"),v(\"p\",[t._v(\"1.0.1.1 比 1.0.1 版本高。\")]),t._v(\" \"),v(\"p\",[t._v(\"1.0.10 比 1.0.9.4 版本高。\")]),t._v(\" \"),v(\"p\",[t._v(\"1.0.10 和 1.0.010 版本号一样高, 每个版本号部分的前导 0 会被忽略。\")]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 将 \"),v(\"strong\",[t._v(\"SQL\")]),t._v(\" 文件分为 \"),v(\"strong\",[t._v(\"Versioned\")]),t._v(\" 、\"),v(\"strong\",[t._v(\"Repeatable\")]),t._v(\" 和 \"),v(\"strong\",[t._v(\"Undo\")]),t._v(\" 三种：\")]),t._v(\" \"),v(\"ul\",[v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Versioned\")]),t._v(\" 用于版本升级, 每个版本有唯一的版本号并只能执行一次.\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Repeatable\")]),t._v(\" 可重复执行, 当 \"),v(\"strong\",[t._v(\"Flyway\")]),t._v(\"检测到 \"),v(\"strong\",[t._v(\"Repeatable\")]),t._v(\" 类型的 \"),v(\"strong\",[t._v(\"SQL\")]),t._v(\" 脚本的 checksum 有变动, \"),v(\"strong\",[t._v(\"Flyway\")]),t._v(\" 就会重新应用该脚本. 它并不用于版本更新, 这类的 migration 总是在 \"),v(\"strong\",[t._v(\"Versioned\")]),t._v(\" 执行之后才被执行。\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Undo\")]),t._v(\" 用于撤销具有相同版本的版本化迁移带来的影响。但是该回滚过于粗暴，过于机械化，一般不推荐使用。一般建议使用 \"),v(\"strong\",[t._v(\"Versioned\")]),t._v(\" 模式来解决。\")])])]),t._v(\" \"),v(\"p\",[t._v(\"这三种的命名规则如下图：\")]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-44-09.png\",alt:\"\"}})]),t._v(\" \"),v(\"ul\",[v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Prefix\")]),t._v(\" 可配置，前缀标识，默认值 V 表示 \"),v(\"strong\",[t._v(\"Versioned\")]),t._v(\", R 表示 \"),v(\"strong\",[t._v(\"Repeatable\")]),t._v(\", U 表示 \"),v(\"strong\",[t._v(\"Undo\")])])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Version\")]),t._v(\" 标识版本号, 由一个或多个数字构成, 数字之间的分隔符可用点 . 或下划线 _\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Separator\")]),t._v(\" 可配置, 用于分隔版本标识与描述信息, 默认为两个下划线 __\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Description\")]),t._v(\" 描述信息, 文字之间可以用下划线 _ 或空格 分隔\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[v(\"strong\",[t._v(\"Suffix\")]),t._v(\" 可配置, 后续标识, 默认为 .sql\")])])]),t._v(\" \"),v(\"h2\",{attrs:{id:\"五、flyway-ads代理配置\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#五、flyway-ads代理配置\"}},[t._v(\"#\")]),t._v(\" 五、Flyway ADS代理配置\")]),t._v(\" \"),v(\"ol\",[v(\"li\",[t._v(\"下载\"),v(\"code\",[t._v(\"flyway-commandline-7.9.1-linux-x64.tar\")]),t._v(\"包到安装目录\")]),t._v(\" \"),v(\"li\",[t._v(\"使用\"),v(\"code\",[t._v(\"tar zxvf flyway-commandline-7.9.1-linux-x64.tar\")]),t._v(\" 解压文件\")]),t._v(\" \"),v(\"li\",[t._v(\"使用\"),v(\"code\",[t._v(\"vi /etc/profile\")]),t._v(\" 编辑环境变量\")]),t._v(\" \"),v(\"li\",[t._v(\"添加flyway安装路径到环境变量\\n\"),v(\"img\",{attrs:{src:\"/images/2021-08-03-18-51-17.png\",alt:\"\"}})]),t._v(\" \"),v(\"li\",[t._v(\"使用\"),v(\"code\",[t._v(\"source /etc/profile\")]),t._v(\"更新环境变量\")]),t._v(\" \"),v(\"li\",[t._v(\"配置ADS代理机\")])]),t._v(\" \"),v(\"h2\",{attrs:{id:\"六、ads流水线配置\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#六、ads流水线配置\"}},[t._v(\"#\")]),t._v(\" 六、ADS流水线配置\")]),t._v(\" \"),v(\"ol\",[v(\"li\",[t._v(\"Speed4j后端项目建议在代码库的\"),v(\"code\",[t._v(\"src\\\\main\\\\resources\")]),t._v(\"下的\"),v(\"code\",[t._v(\"DB\\\\migration\")]),t._v(\"存放Sql脚本文件\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-53-21.png\",alt:\"\"}})]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"三级目录命名规则\")])]),t._v(\" \"),v(\"ul\",[v(\"li\",[t._v(\"版本号命名的目录：如V1.0.0，存放该版本中的数据库升级脚本（包含需要手工处理和自动处理的脚本）和check脚本；\")]),t._v(\" \"),v(\"li\",[t._v(\"Views：存放R开头脚本及一些回调脚本，该目录下的脚本为每次执行完V目录下的脚本后均会重复执行的脚本；\")])]),t._v(\" \"),v(\"ol\",{attrs:{start:\"2\"}},[v(\"li\",[t._v(\"将要执行的Sql脚本按照命名规则放到对应文件夹中\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-55-35.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"3\"}},[v(\"li\",[t._v(\"打开ADS-Piplines-发布 配置ADS部署流水线\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-56-37.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"4\"}},[v(\"li\",[t._v(\"选择对应发布管道，点击编辑\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-57-19.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"5\"}},[v(\"li\",[t._v(\"选择对应阶段编辑，选择添加，输入\"),v(\"u\",[t._v(\"flyway\")]),t._v(\"搜索，添加\"),v(\"code\",[t._v(\"Flyway CLI\")])])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-58-54.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"6\"}},[v(\"li\",[t._v(\"Command选择baseline\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-18-59-33.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"7\"}},[v(\"li\",[t._v(\"选择输入框后面小点指定脚本目录\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-19-00-20.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"8\"}},[v(\"li\",[t._v(\"选择sql脚本存储的\"),v(\"code\",[t._v(\"src\\\\main\\\\resources\")]),t._v(\"下的\"),v(\"code\",[t._v(\"DB\\\\migration\")]),t._v(\"目录\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-19-02-15.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"9\"}},[v(\"li\",[t._v(\"配置好对应数据库的url和账户密码\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-19-02-55.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"10\"}},[v(\"li\",[v(\"p\",[t._v(\"再次选择添加，输入“flyway“搜索，再添加Flyway CLI\")])]),t._v(\" \"),v(\"li\",[v(\"p\",[t._v(\"将Command选择为migrate，其他配置与之前相同\")])])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-19-03-45.png\",alt:\"\"}})]),t._v(\" \"),v(\"ol\",{attrs:{start:\"12\"}},[v(\"li\",[v(\"p\",[t._v(\"保存流水线\")]),t._v(\" \"),v(\"blockquote\",[v(\"p\",[t._v(\"注意：首次执行CD后会在数据库生成flyway_schema_history表\")])])])]),t._v(\" \"),v(\"p\",[v(\"strong\",[t._v(\"建议首次执行后再次编辑流水线，禁用flyway baseline任务\")])]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-19-05-52.png\",alt:\"\"}})]),t._v(\" \"),v(\"h2\",{attrs:{id:\"六、flyway-基础命令\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#六、flyway-基础命令\"}},[t._v(\"#\")]),t._v(\" 六、Flyway 基础命令\")]),t._v(\" \"),v(\"h3\",{attrs:{id:\"migrate\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#migrate\"}},[t._v(\"#\")]),t._v(\" \"),v(\"strong\",[t._v(\"Migrate\")])]),t._v(\" \"),v(\"p\",[t._v(\"Migrate命令将模式迁移到最新版本。如果模式历史表不存在，Flyway会自动创建它。\")]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-19-07-04.png\",alt:\"\"}})]),t._v(\" \"),v(\"p\",[t._v(\"Migrate是Flyway工作流的核心。它会扫描文件系统或类路径，寻找可用的迁移，然后和数据库已经应用的迁移进行比较。如果发现有什么不同，就会迁移数据库以缩小差距。\")]),t._v(\" \"),v(\"p\",[t._v(\"Migrate最好在应用程序启动时执行，从而避免数据库和期望代码之间出现不兼容的情况。\")]),t._v(\" \"),v(\"h3\",{attrs:{id:\"clean\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#clean\"}},[t._v(\"#\")]),t._v(\" \"),v(\"strong\",[t._v(\"Clean\")])]),t._v(\" \"),v(\"p\",[t._v(\"Clean命令删除已配置模式中的所有对象。\")]),t._v(\" \"),v(\"p\",[v(\"img\",{attrs:{src:\"/images/2021-08-03-19-10-09.png\",alt:\"\"}})]),t._v(\" \"),v(\"p\",[t._v(\"Clean对开发测试有很大帮助。它能将你已配置的模式完全清除，从而有效地提供一个全新的开始。所有对象（表、视图、过程……）都会被删除。\")]),t._v(\" \"),v(\"h3\",{attrs:{id:\"info\"}},[v(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#info\"}},[t._v(\"#\")]),t._v(\" \"),v(\"strong\",[t._v(\"Info\")])]),t._v(\" \"),v(\"p\",[t._v(\"Info命令打印所有迁移的详细信息和状态信息。\")])])}),[],!1,null,null,null);_.default=r.exports}}]);","extractedComments":[]}